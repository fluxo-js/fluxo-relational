/*! fluxo_relational v0.0.1 | (c) 2015 Samuel Sim√µes |  */
!function(a,b){if("function"==typeof define&&define.amd)define(["fluxo"],b);else if("undefined"!=typeof exports){var c=require("fluxo");module.exports=b(c)}else a.Fluxo.Relational=b(a.Fluxo)}(this,function(a){var b={};return b.Base={currentStoreValue:function(){return this.store.data[this.key]},parse:function(a){var b=a;return a||a===[]?a instanceof this.storeClass?this.listenChildChanges(a):this.currentStoreValue()instanceof this.storeClass?(this.updateCurrentChild(a),b=this.currentStoreValue()):b=this.instantiateStore(a):this.cancelChildListening(),b},cancelChildListening:function(){this.changeEventCanceler&&(this.changeEventCanceler.call(),delete this.changeEventCanceler)},listenChildChanges:function(a){this.cancelChildListening();var b=function(a){var b=Array.prototype.slice.call(arguments,1);b.unshift(this.key+":"+a),this.store.triggerEvent.apply(this.store,b)};this.changeEventCanceler=a.on(["*"],b.bind(this))},instantiateStore:function(a){var b=new this.storeClass(a);return this.listenChildChanges(b),b}},b.HasOne=function(b){this.store=b.store,this.storeClass=b.storeClass||a.Store,this.key=b.key},b.HasMany=function(b){this.store=b.store,this.storeClass=b.storeClass||a.CollectionStore,this.key=b.key},b.HasOne.prototype=a.extend({updateCurrentChild:function(a){this.currentStoreValue().set(a)}},b.Base),b.HasMany.prototype=a.extend({updateCurrentChild:function(a){this.currentStoreValue().resetFromData(a)}},b.Base),b.Store=a.Store.extend({parsedRelations:{},_constructor:function(){this.parseRelations(),a.Store.prototype._constructor.apply(this,arguments)},parseRelations:function(){for(var a in this.relations){var b=this.relations[a];this.parsedRelations[a]=new b.type({store:this,key:a,storeClass:b.storeClass})}},setAttribute:function(b,c,d){var e=this.parsedRelations[b];return e&&(c=e.parse(c)),a.Store.prototype.setAttribute.call(this,b,c,d)},toJSON:function(){var a={};for(var b in this.data){var c=this.data[b];"function"==typeof c.toJSON?a[b]=c.toJSON():a[b]=c}return a}}),b});
//# sourceMappingURL=fluxo_relational.map