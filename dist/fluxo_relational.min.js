/*! fluxo_relational v0.0.1 | (c) 2015 Samuel Sim√µes |  */
!function(a,b){if("function"==typeof define&&define.amd)define(["fluxo"],b);else if("undefined"!=typeof exports){var c=require("fluxo");module.exports=b(c)}else a.Fluxo.Relational=b(a.Fluxo)}(this,function(a){var b={},c=function(a){var b=typeof a;return"function"===b||"object"===b&&!!a};return b.Base={create:function(){var b=Array.prototype.slice.call(arguments);b.unshift({},this);var c=a.extend.apply(null,b);return c},parse:function(a){return c(a)||a===[]?this.currentValue&&!a._fluxo?this.update(a):a._fluxo?(this.currentValue=a,this.setupListening()):(this.currentValue=this.createStore(a),this.setupListening()):(this.cancelListening(),this.currentValue=a),this.currentValue},cancelListening:function(){this.changeEventCanceler&&(this.changeEventCanceler.call(),delete this.changeEventCanceler)},setupListening:function(){this.cancelListening();var a=function(a){var b=Array.prototype.slice.call(arguments,1);b.unshift(this.key+":"+a),this.store.triggerEvent.apply(this.store,b)};this.changeEventCanceler=this.currentValue.on(["*"],a.bind(this))}},b.HasMany=b.Base.create({createStore:function(b){return a.CollectionStore.create(this.storeObject,{stores:b})},update:function(a){this.currentValue.setStores(a)}}),b.HasOne=b.Base.create({createStore:function(b){return a.ObjectStore.create(this.storeObject,{data:b})},update:function(a){this.currentValue.set(a)}}),b.ObjectStore=a.ObjectStore.create({setup:function(){this.relations=a.extend({},this.relations),this.parseRelations(),a.ObjectStore.setup.apply(this,arguments)},parseRelations:function(){for(var a in this.relations){var b=this.relations[a];this.relations[a]=b.type.create({key:a,store:this,storeObject:{}},b)}},setAttribute:function(b,c,d){var e=this.relations[b];return e&&(c=e.parse(c)),a.ObjectStore.setAttribute.call(this,b,c,d)},toJSON:function(){var b=a.ObjectStore.toJSON.call(this);for(var c in b){var d=b[c];"function"==typeof d.toJSON&&(b[c]=d.toJSON())}return b}}),b});
//# sourceMappingURL=fluxo_relational.map